<!--
 * @Author: lilu
 * @Date: 2023-02-16 20:23:16
 * @LastEditors: lilu
 * @LastEditTime: 2023-06-13 14:47:03
 * @Description: 
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<style>
    body {
        width: 100%;
        margin: 0;
    }
    .videoWrapper {
        width: 100%;
    }
    video{
        width: 100%;
        height: 320px;
        border: 1px solid red;
        transform: scale(1);
    }
    #myCanvas {
        display: none;
    }
</style>
<body>
    <div class="videoWrapper">
        <video id="myVideo" autoplay controls></video>
    </div>
    <canvas id="myCanvas"></canvas>
    <button id="myButton">Capture</button>
    <button id="againButton">Capture Again</button>

    <script type="text/javascript">
        document.getElementById("myButton").addEventListener("click", () => {
            console.log('aa')
            const videoEle = document.getElementById("myVideo")
            const myCav = document.getElementById("myCanvas")
            myCav.width = videoEle.clientWidth
            myCav.height = videoEle.clientHeight
            myCav.style.display = 'block'
            const context = myCav.getContext('2d')
            context.drawImage(videoEle, 0, 0, videoEle.clientWidth, videoEle.clientHeight)
            const dataUrl =  myCav.toDataURL()
            // console.log('base 64', dataUrl)
            console.log(base64ToFile(dataUrl, 'test'))
        })

        document.getElementById("againButton").addEventListener("click", () => {
            const myCav = document.getElementById("myCanvas")
            const context = myCav.getContext('2d')
            context.clearRect(0, 0, myCav.width, myCav.height)
            myCav.style.display = 'none'
        })
         navigator.mediaDevices.getUserMedia({video: {
            width:640,
            height:480,
            facingMode: {ideal:"environment"},
         }}).then(stream => {
             console.log(stream)
             const videoEle = document.getElementById("myVideo")
             console.log(videoEle)
             videoEle.srcObject  = stream
         })

         function base64ToFile(base64, fileName) {
            let arr = base64.split(',');
            let mime = arr[0].match(/:(.*?);/)[1];
            let bstr = atob(arr[1]);
            let n = bstr.length;
            let u8arr = new Uint8Array(n);

            while(n--){
                u8arr[n] = bstr.charCodeAt(n);
            }
            return new File([u8arr], fileName, {type: mime});
        }
    </script>
</body>
</html>
